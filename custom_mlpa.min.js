$("#modflair").html(`M<span class="toggle-label">od </span>F<span class="toggle-label">lair</span>`);setTimeout(function(){$("#chatwrap").hide()},100);setTimeout(function(){$("#chatwrap").show()},600);$("#chanexternalcss").insertBefore("#chancss");window[CHANNEL.name].clearChat=function(data){var msgData={time:Date.now(),username:"MLP Anniversary Chat",msg:'<img class="image-embed-small" src="http://i.imgur.com/quajcnG.png">',meta:{shadow:false}};addChatMessage(msgData)};socket.on("clearchat",function(data){window[CHANNEL.name].clearChat(data)});function changeStream(data){Callbacks.changeMedia({currentTime:0,duration:"--:--",id:data.id,meta:{embed:{src:String().concat("http://www.ustream.tv/embed/",data.id,"?v=3&wmode=direct&autoplay=1"),tag:"iframe"}},paused:false,seconds:0,title:String().concat("Ustream.tv - channel/",data.name),type:"us"})}$("#quickStream").remove();(function(){var streamChoices=[{id:"16558159",name:"woeful-streaming"},{id:"20308283",name:"ponyspazz"},{id:"13392289",name:"the-brony-network"},{id:"20768037",name:"btvnumanother"}];var quickStream=$("<div/>").addClass("btn-group dropdown").prop("id","quickStream").prependTo("#videocontrols").hide();$("<button/>").addClass("btn btn-default btn-sm dropdown-toggle").attr("type","button").attr("title","Stream Select").attr("href","javascript:void(0)").attr("data-toggle","dropdown").html("<strong> Pony Stream </strong><span class='caret'></span>").appendTo(quickStream);var quickChoices=$("<ul/>").addClass("dropdown-menu ul-double").appendTo(quickStream);streamChoices.filter(function(i){var item=$("<li/>").addClass("li-double").html($("<a/>").text(i.name).data("streamid",i.id).data("streamname",i.name).click(function(){changeStream({id:$(this).data("streamid"),name:$(this).data("streamname")})})).appendTo(quickChoices)});if(!window.ponystreamlistener){window.ponystreamlistener=true;socket.on("changeMedia",function(data){if(data.type=="us"&&data.id.match(/13392289|16558159|20308283|20768037/)){$("#quickStream").show();$("#quickQuality").hide()}else{$("#quickStream").hide();$("#quickQuality").show()}});var initialVid=playlist(true)["media"];if(initialVid&&initialVid.type=="us"&&data.id.match(/13392289|16558159|20308283|20768037/)){$("#quickStream").show();$("#quickQuality").hide()}else{$("#quickStream").hide();$("#quickQuality").show()}}})();$("#chatline").trigger("registerCommand",["boop",function(message){var parameters=message.substring(1).replace(/boop\s/,"");socket.emit("chatMsg",{meta:{},msg:`/me boops ${parameters} :mylove: `})}]);this[CHANNEL.name].uguu={};this[CHANNEL.name].uguu.generate=function(){var base_url="https://resources.pink.horse/sounds/uguu/";var choice=Math.floor(Math.random()*85)+1;this.current=new Audio(base_url+"uguu."+(()=>{if(choice<10){return"0"+choice}else return choice})()+".ogg")};this[CHANNEL.name].uguu.play=function(){this.generate();this.current.play()};function playSound(url,vol){console.log("Transmutor playing sound");const sound=new Audio(url);sound.volume=vol;sound.play()}void function(transmutors){$("#messagebuffer").unbind("click.transmote");$("#messagebuffer").on("click.transmote","img.channel-emote",function(ev){function transmote(target,emote){var result=CHANNEL.emotes.filter(cv=>{return cv.name===emote});if(!result.length){return console.error("Transmutor target not found")}$(target).attr("title",emote).attr("src",result.pop().image)}function morph(target,data){$(target).attr("src",data.url).attr("title",data.title)}var subject=transmutors[$(this).attr("title")];if(!subject){return}Object.keys(subject).forEach(cv=>{if(subject[cv]){switch(cv){case"sound":return playSound(subject.sound.url,subject.sound.vol);case"transmote":return transmote(this,subject.transmote);case"morph":return morph(this,subject.morph);case"custom":return subject.custom(this)}}})})}({":feel:":{transmote:":feelsgood:"},":feelsgood:":{transmote:":feel:"},":what:":{transmote:":good.show:"},":good.show:":{transmote:":what:"},":hahahahahahahahaha:":{sound:{url:"https://resources.pink.horse/sounds/fenneko.ogg",vol:.33}},":twss:":{sound:{url:"https://resources.pink.horse/sounds/thats.what.she.said.ogg",vol:.75}},":laughingponywhores:":{sound:{url:"https://resources.pink.horse/sounds/pp.giggle.ogg",vol:.33}},":sadpinkie:":{sound:{url:"https://resources.pink.horse/sounds/pp.oh.no.ogg",vol:.33}},":suspicious:":{sound:{url:"https://resources.pink.horse/sounds/pp.suspicious.ogg",vol:.33}},":forever:":{sound:{url:"https://resources.pink.horse/sounds/forever.ogg",vol:.33}},":books:":{sound:{url:"https://resources.pink.horse/sounds/by.the.book.ogg",vol:.33}},":cry:":{sound:{url:"https://resources.pink.horse/sounds/howcouldthishappen.ogg",vol:.33}},":wahaha:":{sound:{url:"https://resources.pink.horse/sounds/wahahaha.ogg",vol:.33}},":ew.scoot:":{sound:{url:"https://resources.pink.horse/sounds/ewwww.ogg",vol:.33}},":it.aint.me:":{sound:{url:"https://resources.pink.horse/sounds/it.aint.me.ogg",vol:.33}},":feelsnoon:":{sound:{url:"https://resources.pink.horse/sounds/high.noon.ogg",vol:.33}},":airhorn:":{sound:{url:"https://resources.pink.horse/sounds/airhorn.mp3",vol:.33}},":squee:":{sound:{url:"https://resources.pink.horse/sounds/squee.ogg",vol:.33}},":yay:":{sound:{url:"https://resources.pink.horse/sounds/yay.ogg",vol:.33}},":hoo:":{sound:{url:"https://resources.pink.horse/sounds/hoo.ogg",vol:.33}},":fun:":{sound:{url:"https://resources.pink.horse/sounds/pp.fun.ogg",vol:.42}},":fakkyu:":{sound:{url:"https://resources.pink.horse/sounds/fuckyou.opus",vol:.42}},":darling:":{sound:{url:"http://zizzydizzymc.info/ss/thankyoudarling.ogg",vol:.42}},":tree:":{sound:{url:"https://xaekai.net/niggers.tree.ogg",vol:.88}},":uguu:":{custom:()=>{window[CHANNEL.name].uguu.play()}},":gmew:":{custom:target=>{if($(target).attr("src").includes("wew")){$(target).attr("src","https://resources.pink.horse/images/emotes/toriel.pie.png")}else{$(target).attr("src","https://resources.pink.horse/images/emotes/toriel.wew.png")}}},":awoo.shuffle:":{custom:target=>{if($(target).attr("src").includes("back")){$(target).attr("src","https://resources.pink.horse/images/emotes/momijidance.trans.gif")}else{$(target).attr("src","https://resources.pink.horse/images/emotes/momijidance.back.trans.gif")}}},":succ:":{morph:{url:"https://resources.pink.horse/images/emotes/succ.super.png",title:"ssucc?"}},"ssucc?":{transmote:":succ:",sound:{url:"https://resources.pink.horse/sounds/succ.mp3",vol:.33}},":chen:":{morph:{title:"alpha chen",url:"https://i.imgur.com/TGHRo8W.gif"},sound:{url:"https://resources.pink.horse/sounds/chen.ogg",vol:.33}},"alpha chen":{morph:{title:"omega chen",url:"https://i.imgur.com/MSoQrxX.gif"},sound:{url:"https://resources.pink.horse/sounds/trainhorn-k5la.ogg",vol:.33}},"omega chen":{transmote:":chen:",sound:{url:"https://resources.pink.horse/sounds/ship.fog.horn.air.chime.ogg",vol:.33}}});$("#ugh").remove();$("#blockrefs").remove();$("<button>").attr("id","ugh").addClass("btn btn-sm btn-default").text("Block referrers").on("click",function(){if($(this).hasClass("btn-success")){$("#blockrefs").remove()}else{$("<meta>").attr("name","referrer").attr("content","no-referrer").attr("id","blockrefs").appendTo($("head"));$("img[class*=embed]:not(refblock)").each(function(){$(this).attr("src",$(this).attr("src")+"#"+Date.now()).addClass("refblock")})}$(this).toggleClass("btn-default btn-success")}).prependTo("#leftcontrols");function addUserDropdown(entry){var name=entry.data("name"),rank=entry.data("rank"),leader=entry.data("leader"),meta=entry.data("meta")||{};entry.find(".user-dropdown").remove();var menu=$("<div/>").addClass("user-dropdown").appendTo(entry).hide();$("<strong/>").text(name).appendTo(menu);$("<br/>").appendTo(menu);var btngroup=$("<div/>").addClass("btn-group-vertical").appendTo(menu);var ignore=$("<button/>").addClass("btn btn-xs btn-default").appendTo(btngroup).click(function(){if(IGNORED.indexOf(name)==-1){ignore.text("Unignore User");IGNORED.push(name);entry.addClass("userlist-ignored")}else{ignore.text("Ignore User");IGNORED.splice(IGNORED.indexOf(name),1);entry.removeClass("userlist-ignored")}setOpt("ignorelist",IGNORED)});if(IGNORED.indexOf(name)==-1){entry.removeClass("userlist-ignored");ignore.text("Ignore User")}else{entry.addClass("userlist-ignored");ignore.text("Unignore User")}if(name!==CLIENT.name){var pm=$("<button/>").addClass("btn btn-xs btn-default").text("Private Message").appendTo(btngroup).click(function(){initPm(name).find(".panel-heading").click();menu.hide()})}if(hasPermission("leaderctl")){var ldr=$("<button/>").addClass("btn btn-xs btn-default").appendTo(btngroup);if(leader){ldr.text("Remove Leader");ldr.click(function(){socket.emit("assignLeader",{name:""})})}else{ldr.text("Give Leader");ldr.click(function(){socket.emit("assignLeader",{name:name})})}}const exception=["porknut","nutt"].includes(name.toLowerCase())&&CLIENT.rank<3;if(hasPermission("kick")&&!exception){$("<button/>").addClass("btn btn-xs btn-default").text("Kick").click(function(){var reason=prompt("Enter kick reason (optional)");if(reason===null){return}socket.emit("chatMsg",{msg:"/kick "+name+" "+reason,meta:{}})}).appendTo(btngroup)}if(hasPermission("mute")&&!exception){var mute=$("<button/>").addClass("btn btn-xs btn-default").text("Mute").click(function(){socket.emit("chatMsg",{msg:"/mute "+name,meta:{}})}).appendTo(btngroup);var smute=$("<button/>").addClass("btn btn-xs btn-default").text("Shadow Mute").click(function(){socket.emit("chatMsg",{msg:"/smute "+name,meta:{}})}).appendTo(btngroup);var unmute=$("<button/>").addClass("btn btn-xs btn-default").text("Unmute").click(function(){socket.emit("chatMsg",{msg:"/unmute "+name,meta:{}})}).appendTo(btngroup);if(meta.muted){mute.hide();smute.hide()}else{unmute.hide()}}if(hasPermission("ban")&&!exception){$("<button/>").addClass("btn btn-xs btn-default").text("Name Ban").click(function(){var reason=prompt("Enter ban reason (optional)");if(reason===null){return}socket.emit("chatMsg",{msg:"/ban "+name+" "+reason,meta:{}})}).appendTo(btngroup);$("<button/>").addClass("btn btn-xs btn-default").text("IP Ban").click(function(){var reason=prompt("Enter ban reason (optional)");if(reason===null){return}socket.emit("chatMsg",{msg:"/ipban "+name+" "+reason,meta:{}})}).appendTo(btngroup)}var showdd=function(ev){if(ev.shiftKey)return true;ev.preventDefault();if(menu.css("display")=="none"){$(".user-dropdown").hide();$(document).bind("mouseup.userlist-ddown",function(e){if(menu.has(e.target).length===0&&entry.parent().has(e.target).length===0){menu.hide();$(document).unbind("mouseup.userlist-ddown")}});menu.show();menu.css("top",entry.position().top)}else{menu.hide()}return false};entry.contextmenu(showdd);entry.click(showdd)}["kick","ban","ipban","mute"].forEach(command=>{$("#chatline").trigger("registerCommand",[command,function(message){const exception=new RegExp(["nutt","porknut"].join("|")).test(message.toLowerCase());console.log(message,exception);if(exception){return $("#messagebuffer").trigger("whisper",`[System] Yeah, no. If this user needs disciplinary action, contact Xaekai.`)}socket.emit("chatMsg",{meta:{},msg:message})}])});["nutt","Porknut"].forEach(user=>{const isPresent=userlist(true).includes(user);if(isPresent){addUserDropdown(findUserlistItem(user))}});if(!CLIENT.patrician){CLIENT.patrician=true;socket.on("changeMedia",data=>{checkPatricianStatus(data)})}function checkPatricianStatus({type:type,id:id,title:title,seconds:seconds,currentTime:currentTime,duration:duration,paused:paused}){if(type!=="cm"){return}if(!id.match(/manifest\.xaekai\.net/)){return}if(typeof window.getGoogleDriveMetadata!=="function"){return}$.ajax({dataType:"json",url:id,success:manifest=>{if(typeof manifest.gdocs==="string"){const gdid=atob(manifest.gdocs);Callbacks.changeMedia({type:"gd",id:gdid,meta:{},title:title,seconds:seconds,currentTime:currentTime,duration:duration,paused:paused})}}})}